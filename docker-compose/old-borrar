version: '3'
services:
  wrapper-provider:
    build:
      context: ../services/wrapper-provider
      dockerfile: Dockerfile
    image: wrapper-provider:0.0.2
    ports:
        - "3601:3601"
    environment:
        - "TARGET_PROXY=http://host.docker.internal:8080/rest/camara-device-identifier-and-token-api/0.0.1"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - dapr-network
  business-operator-token:
    build:
      context: ../services/business-operator-token
      dockerfile: Dockerfile
    image: business-operator-token:0.0.2
    ports:
        - "3701:3701"
    environment:
        - "DAPR_APP_ID=dapr-proxy-microcks"
        - "APP_PORT=7001"
        - "DAPR_TOKEN_STORE_NAME=tokenstore"
    networks:
      - dapr-network
  business-operator-egress:
    build:
      context: ../services/business-operator-egress
      dockerfile: Dockerfile
    image: business-operator-egress:0.0.4
    ports:
        - "3910:3910"
    environment:
        - "DAPR_APP_ID=business-operator-token"
        - "APP_PORT=9010"
        - "DAPR_TOKEN_STORE_NAME=tokenstore"
        - "TARGET_PROXY_HOST=wrapper-provider"
        - "TARGET_PROXY_PORT=3601"
    networks:
      - dapr-network
    volumes:
        - "../dapr/:/components"
  redis:
    image: "redis:6"
    ports:
      - "6379:6379"
    networks:
      - dapr-network     
networks:
    dapr-network: